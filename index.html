<!DOCTYPE html>
<html lang="es" xmlns="http://www.w3.org/1999/xhtml">
<head>
<!--Obra : EditorC4D : Software para ilustrar en la Web, Autor: Jorge Julian Sanchez Velez, DNDA: Registro nacional de Derechos de autor Libro 13 Tomo 32 Partida 433 20120320 -->
<title>EditorC4D</title>
<meta       name = "Instante"     content = "20251027090200100"/>
<meta       name = "Latitud"      content = "6.3370°"/>
<meta       name = "Longitud"     content = "-75.6015°"/>
<meta       name = "Altitud"      content = "2500mt."/>
<meta       name = "Autor"        content = "jorge4d"/>
<meta       name = "Email"        content = "labsvjj@gmail.com"/>
<meta       name = "keywords"     content = "Editor SVG Cuarta Dimension ToDo4D"/>
<meta       name = "description"  content = "Editor para un lenguaje social gráfico"/>
<meta       name = "viewport"     content = "width=device-width, initial-scale=1.0">
<meta http-equiv = "Expires"      content = "Tue, 25 Abr 1990 09:30:00 -0700"/>
<meta http-equiv = "Content-Type" content = "text/html;charset=utf-8"/>
<meta http-equiv = "encoding"     content = "utf-8"/>
<style>.boton       {background-color: #d7d7d7;}.boton:hover {background-color: rgb(128,128,128);}.bactivo     {background-color: yellow;}</style>
</head>
<body>
<input  id="imagenes"  onChange="recorta();" style="display:none;" type="file" accept="image/*" />
<input  id="objetos4d" onChange="leeXML();"  style="display:none;" type="file" accept=".htm"  />
<img    id="imagen"     style="display: block; position:absolute; top: 32px;  left: 0px; "/>
<canvas id='canvas64' onclick="suiche4d('myCanvas4D')"   style="cursor: pointer;cursor: hand; background-color: rgb(224,224,224); position: absolute; left: 0px; top: 0px; width: 32px; height: 32px; cursor:pointer; cursor:hand; " width='32px' height='32px'></canvas>
<svg id="bimagen" onclick="document.getElementById('imagenes').click();" class="boton" viewBox="0 0 32 32" style="cursor: pointer; position: absolute; width: 32px; height: 32px; top: 0px; left: 0px;">
  <g id="gimagen" style="display: block;">
    <polyline style="fill: black; stroke: black; stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="32,0 30,2 30,29.5 32,32 29.5,30 2,30 0,32 32,32 32,0"></polyline>
    <polyline style="fill: blue;  stroke: blue;  stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="2,2 29.5,2 29.5,16 2,16 2,2"></polyline>
    <polyline style="fill: green; stroke: green; stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="2,16 12,7 29.5,29.5 2,29.5 2,16"></polyline>
    <polyline style="fill: lime;  stroke: lime;  stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="2,29.5 25,10 29.5,16 29.5,29.5 2,29.5"></polyline>
    <circle cx="18" cy="5" r="2" style="stroke-width: 0.5; stroke: orange; fill: yellow;"></circle>
  </g>
</svg>
<svg    id="b2" onclick="poly4d()"     class="boton" viewBox="0 0 32 32"   style="cursor: pointer;cursor: hand; position: absolute; width: 32px; height: 32px; top: 0px; left: 32px;">
    <polyline style="fill: black; stroke: black;  stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="32,0 30,2 30,29.5 32,32 29.5,30 2,30 0,32 32,32 32,0"></polyline>
    <polyline id="pol" style="fill: white; stroke: white;  stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="2,2 29.5,2 29.5,29.5 2,29.5 2,2"></polyline>
    <polyline id="ruta" points="7,11 16.5,6 25,16 20,25 11,23 7,11" style="fill: none; stroke: black; stroke-width: 0.5;"></polyline>
    <polyline points="6,10 7.5,10 7.5,12 6,12 6,10" style="fill: none; stroke: blue; stroke-width: 0.5;"></polyline>
</svg>
<svg id="b4" onclick="colorear4d()" class="boton" viewBox="0 0 32 32" style="cursor: pointer; cursor: hand; position: absolute; width: 32px; height: 32px; top: 0px; left: 64px;">
  <polyline style="fill: black; stroke: black; stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="32,0 30,2 30,29.5 32,32 29.5,30 2,30 0,32 32,32 32,0"></polyline>
  <polyline style="fill: white; stroke: white; stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="2,2 29.5,2 29.5,29.5 2,29.5 2,2"></polyline>
  <polyline id="relleno" style="fill: black; stroke: black; stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="8,8 13,8 13,13 8,13 8,8"></polyline>
  <polyline id="esqueleto" style="fill: none; stroke: black; stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="17,16 22,16 22,21 17,21 17,16"></polyline>
</svg>
<svg id="b5" onclick="atras4d()" class="boton" viewBox="0 0 32 32" style="cursor: pointer; cursor: hand; position: absolute; width: 32px; height: 32px; top: 0px; left: 96px;">
  <polyline style="fill: black; stroke: black; stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="32,0 30,2 30,29.5 32,32 29.5,30 2,30 0,32 32,32 32,0"></polyline>
  <polyline style="fill: white; stroke: white; stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="2,2 29.5,2 29.5,29.5 2,29.5 2,2"></polyline>
  <polyline id="atras" style="fill: black; stroke: none; stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="8,8 26,8 26,26 8,26 8,8"></polyline>
  <polyline style="fill: white; stroke: black; stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="6,6 24,6 24,24 6,24 6,6"></polyline>
</svg>
<svg id="bcolor" viewBox="0 0 32 32" style="position: absolute; width: 32px; height: 32px; top: 0px; left: 128px;">
  <a href="#" onclick="actualiza4d('yellow'); return false;"><polyline style="fill: yellow; stroke: yellow; stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="2,2 14,2 14,7 2,7 2,2"></polyline></a>
  <a href="#" onclick="actualiza4d('orange'); return false;"><polyline style="fill: orange; stroke: orange; stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="2,8 14,8 14,13 2,13 2,8"></polyline></a>
  <a href="#" onclick="actualiza4d('red'); return false;"><polyline style="fill: red; stroke: red; stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="2,14 14,14 14,19 2,19 2,14"></polyline></a>
  <a href="#" onclick="actualiza4d('brown'); return false;"><polyline style="fill: brown; stroke: brown; stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="2,20 14,20 14,25 2,25 2,20"></polyline></a>
  <a href="#" onclick="actualiza4d('black'); return false;"><polyline style="fill: black; stroke: black; stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="2,26 14,26 14,31 2,31 2,26"></polyline></a>

  <a href="#" onclick="actualiza4d('white'); return false;"><polyline style="fill: white; stroke: white; stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="18,2 30,2 30,7 18,7 18,2"></polyline></a>
  <a href="#" onclick="actualiza4d('gray'); return false;"><polyline style="fill: gray; stroke: gray; stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="18,8 30,8 30,13 18,13 18,8"></polyline></a>
  <a href="#" onclick="actualiza4d('purple'); return false;"><polyline style="fill: purple; stroke: purple; stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="18,14 30,14 30,19 18,19 18,14"></polyline></a>
  <a href="#" onclick="actualiza4d('blue'); return false;"><polyline style="fill: blue; stroke: blue; stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="18,20 30,20 30,25 18,25 18,20"></polyline></a>
  <a href="#" onclick="actualiza4d('green'); return false;"><polyline style="fill: green; stroke: green; stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="18,26 30,26 30,31 18,31 18,26"></polyline></a>

</svg>
<svg id="b3" onclick="colorpic4d()" class="boton" viewBox="0 0 32 32" style="cursor: pointer;cursor: hand; position: absolute; width: 32px; height: 32px; top: 0px; left: 160px;">
  <polyline style="fill: black; stroke: black;  stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="32,0 30,2 30,29.5 32,32 29.5,30 2,30 0,32 32,32 32,0"></polyline>
  <polyline style="fill: white; stroke: white;  stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="2,2 29.5,2 29.5,29.5 2,29.5 2,2"></polyline>
  <polyline id="pat" style="fill: none; stroke: black;  stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="7,7 25,7 25,25 7,25 7,7"></polyline>
  <polyline style="fill: none; stroke: black;  stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="16,11 16,10 19.5,6.5 20.5,7.5 17,11 16,11"></polyline>
  <polyline style="fill: blue; stroke: blue;  stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="22.5,4.5 22.5,6 21.5,7 21.5,8 21,8.5 18.5,6 19,5.5 19.5,5.5 21,4 22.5,4.5"></polyline>
</svg>
<svg id="b6" onclick="document.getElementById('objetos4d').click();" class="boton" viewBox="0 0 32 32" style="cursor: pointer;cursor: hand; position: absolute; width: 32px; height: 32px; top: 0px; left: 192px;">
  <polyline style="fill: black; stroke: black; stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="32,0 30,2 30,29.5 32,32 29.5,30 2,30 0,32 32,32 32,0"></polyline>
  <polyline style="fill: white; stroke: white; stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="2,2 29.5,2 29.5,29.5 2,29.5 2,2"></polyline>
  <polyline style="fill: none; stroke: black; stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="7,25 25,25 25,28 7,28 7,25"></polyline>
  <polyline style="fill: none; stroke: black; stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="16,3 25,13 20,13 20,23 12,23 12,13 7,13 16,3"></polyline>
</svg>
<svg id="b7" onclick="salv4d()" class="boton" viewBox="0 0 32 32" style="cursor: pointer;cursor: hand; position: absolute; width: 32px; height: 32px; top: 0px; left: 224px;">
  <polyline style="fill: black; stroke: black;  stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="32,0 30,2 30,29.5 32,32 29.5,30 2,30 0,32 32,32 32,0"></polyline>
  <polyline style="fill: white; stroke: white;  stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="2,2 29.5,2 29.5,29.5 2,29.5 2,2"></polyline>
  <polyline style="fill: none; stroke: black;  stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="7,25 25,25 25,28 7,28 7,25"></polyline>
  <polyline style="fill: none; stroke: black;  stroke-width: 0.5; stroke-linecap: round; stroke-linejoin: round;" points="16,23 7,14 12,14 12,3 20,3 20,14 25,14 16,23"></polyline>
</svg>
<canvas id='myCanvas4D' style="background-color: rgb(255,255,255); position: absolute; display: block; left: 0px; top: 32px; width:256px; height: 256px;" width='256px' height='256px'></canvas>
<svg    id="panel4d"    style="outline: black solid 1px; position: absolute; left: 0px; top: 32px; width: 256px; height: 256px;" viewBox="0 0 256 256" preserveAspectRatio="none">
	<circle id="circuloz" shape-rendering="auto"  cx="128" cy="128" r="15" style="display: none; cursor: pointer; cursor: hand;" fill="rgba(0,255,0,0.1)" stroke="lime"></circle>
	<polyline id="marcolinea" shape-rendering="geometricPrecision" points="0,0,256,0,256,256,0,256,0,0" style="display: none; fill: none; stroke: lime; stroke-width: 1; stroke-linecap: round; stroke-linejoin: round; stroke-dasharray: 5,5 ;"></polyline>
</svg>
<svg    id="slider4d"  style="position: absolute; left: 0px; top: 288px; width: 256px; height: 64px;" width="256" height="64">
  <rect id="sliderbase" x="15" y="20" width="226" height="10" fill="rgb(224,224,224)" style="display: none;"/>
  <circle id="sliderzoom" cx="226" cy="25" r="15" fill="lime" style="display: none; cursor: pointer" />
</svg>
<script>
//setup
var canvas1   = document.getElementById("myCanvas4D"), canvas4d  = canvas1.getContext("2d");
var canvas2   = document.getElementById("canvas64"),   canvas24d = canvas2.getContext("2d");
var croping = "0";
var pruta ="", sty="", styt="";
var x = 256, y = 256, z = 4, t = 1;
var dx = 0, dy = 0, factor = 1;
var xanterior = x, yanterior = y, zoom =256;
var relacionx = 1, relaciony = 1;
var dibujando = 0, r, pa = '', pi = '', pix, piy, conta = 0, contatext=0, actual='';
var moviendoblip = '', seleccionado = '', rutaseleccionada, colorfil = 'none', colorstroke = '#000000', grueso = '1';
var autor  = "labSVJJ", latitud  = "6.2529001235962", longitud = "-75.564598083496", altitud  = "1600.00", instante  = "2025/10/02_07:29:00";
var gotero = false, intro = false, colorear = true;
var k = 0, puntos = '', sty = '';
var fila4d = [], array;
var dragging = false;
var draggingCircle = false;
// touch listener
if (window.addEventListener) {document.getElementById('sliderzoom').addEventListener('touchstart', touchslider, false);} else {document.getElementById('sliderzoom').touchstart = touchslider;}
function touchslider(e) {
	dragging = true;
}
if (window.addEventListener) {document.getElementById('sliderzoom').addEventListener('touchend', touchsliderend, false);} else {document.getElementById('sliderzoom').touchend = touchsliderend;}
function touchsliderend(e) {
	dragging = true;
}
if (window.addEventListener) {document.getElementById('slider4d').addEventListener('touchmove', touchslidermueve, false);} else {document.getElementById('slider4d').touchmove = touchslidermueve;}
function touchslidermueve(e) {
    if (!dragging) return;
    var touch = e.touches[0];
    var rect = slider4d.getBoundingClientRect();
    var x = touch.clientX - rect.left;
    x = Math.max(1, Math.min(256, x));
    sliderzoom.setAttribute('cx', x);
    zoom = x;
    marcozoom();
    e.preventDefault();
}
// circulo zoom touch
if (window.addEventListener) {document.getElementById('circuloz').addEventListener('touchstart', circulotouch, false);} else {document.getElementById('circuloz').touchstart = circulotouch;}
function circulotouch(){
	draggingCircle = true;
}
if (window.addEventListener) {document.getElementById('circuloz').addEventListener('touchend', circulofin, false);} else {document.getElementById('circuloz').touchend = circulofin;}
function circulofin(){
	draggingCircle = false;
}
if (window.addEventListener) {document.getElementById('panel4d').addEventListener('touchmove', touchcirculomueve, false);} else {document.getElementById('panel4d').touchmove = touchcirculomueve;}
function touchcirculomueve(e) {
    if (!draggingCircle) return;
    var touch = e.touches[0];
    var rect = panel4d.getBoundingClientRect();
    x = touch.clientX - rect.left;
    y = touch.clientY - rect.top;
	document.getElementById('circuloz').setAttribute('cx', x);
	document.getElementById('circuloz').setAttribute('cy', y);
	marcozoom();
	e.preventDefault();
}
// sliderzoom listener
if (window.addEventListener) {document.getElementById('sliderzoom').addEventListener('mousedown', clicslider, false);} else {document.getElementById('sliderzoom').mousedown = clicslider;}
function clicslider(e) {
	dragging = true;
}
if (window.addEventListener) {document.getElementById('sliderzoom').addEventListener('mouseup', upslider, false);} else {document.getElementById('sliderzoom').mouseup = upslider;}
function upslider(e) {
	dragging = false;
}
if (window.addEventListener) {document.getElementById('slider4d').addEventListener('mousemove', mueveslider, false);} else {document.getElementById('slider4d').mousemove = mueveslider;}
function mueveslider(e) {
	if (!dragging) return;
    var rect = document.getElementById('slider4d').getBoundingClientRect();
    var nx = e.clientX - rect.left;
    nx = Math.max(1, Math.min(256, nx));
    sliderzoom.setAttribute('cx', nx);
    zoom = nx;
    marcozoom();
}
// circulo zoom
if (window.addEventListener) {document.getElementById('circuloz').addEventListener('mousedown', circuloclic, false);} else {document.getElementById('circuloz').mousedown = circuloclic;}
function circuloclic(){
	draggingCircle = true;
}
if (window.addEventListener) {document.getElementById('circuloz').addEventListener('mouseup', circuloup, false);} else {document.getElementById('circuloz').mouseup = circuloup;}
function circuloup(){
	draggingCircle = false;
}
//mouse click
if (window.addEventListener) {document.getElementById('panel4d').addEventListener('click', clicmouse, false);} else {document.getElementById('panel4d').onclick = clicmouse;}
function clicmouse(e) {
	if (croping == "1") return;
	if (gotero) {
		document.getElementById("_gota").remove();
		colorfill = document.getElementById('pat').style.fill;

		gotero = false;
		document.getElementById('panel4d').style.cursor = 'default';
		rehacerfila4d();
		document.getElementById('b3').className.baseVal = "boton";
	}
	e = window.event || e;
	x = parseInt(e.pageX);
	y = parseInt(e.pageY);
	var target = e.target;
	if (moviendoblip) {
		c4d(x, y, 3, moviendoblip, 'lime', 'rgba(0,255,0,0.1)', 'panel4d');
		rehacerfila4d();
		moviendoblip = '';
	} else {
		if (dibujando == 1) {cli(); return;	}
		if (target.id.indexOf('__4Dblip') >= 0) {
			moviendoblip = target.id;
			puntoanterior = target.cx.animVal.value + ',' + target.cy.animVal.value;
		} else {
			if (seleccionado) {
					limpiar4d();
			} else {
				seleccione(e.target);
			}
		}	
	}
	
}
function seleccione(objetivo) {
	limpiar4d();
	if (objetivo.nodeName !== 'svg') {
		seleccionado = objetivo;
		if (objetivo.nodeName === 'polyline') {
			rutaseleccionada = objetivo.points;
			colorfil = objetivo.style.fill;
			colorstroke = objetivo.style.stroke;
			if (colorstroke == 'rgb(0, 0, 0)') {
				colorstroke = '#000000'
			}
			grueso = objetivo.style.strokeWidth;
			poneblips('__4Dblip', objetivo.points, 'lime');
			propiedades4d(seleccionado);
		}
	}
}
function poneblips(pid, puntos, fil) {
	var ptos = puntos.numberOfItems;
	var pruta = '';
	for (var incrementador = 0; incrementador < ptos; incrementador++) {
		blip++;
		c4d(puntos.getItem(incrementador).x, puntos.getItem(incrementador).y, 3, pid + blip, 'rgba(0,255,0,0.1)', fil, 'panel4d');
		pruta += puntos.getItem(incrementador).x + "," + puntos.getItem(incrementador).y + " ";
	}
}
function c4d(cx, cy, radio, pid, fil, str, pan) {
	var o4d;
	if (document.getElementById(pid)) {
		o4d = document.getElementById(pid);
	} else {
		o4d = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
		var antialias = 'true';
		o4d.setAttribute('shape-rendering', antialias ? 'auto' : 'optimizeSpeed');
		o4d.setAttribute('id', pid);
	}
	if (cx)
		o4d.setAttribute('cx', cx);
	if (cy)
		o4d.setAttribute('cy', cy);
	if (radio)
		o4d.setAttribute('r', radio);
	o4d.setAttribute('fill', fil);
	o4d.setAttribute('stroke', str);
	o4d.addEventListener('mouseover', sobremi, false);
	o4d.addEventListener('mouseout', fuerami, false);
	if (!document.getElementById(pid)) {
		document.getElementById(pan).appendChild(o4d);
	}
}
function sobremi(evt) {
	var target = evt.target;
	target.setAttributeNS(null, 'style', 'cursor:pointer;cursor:hand;');
	target.setAttributeNS(null, 'fill', 'red');
	target.setAttributeNS(null, 'stroke', 'red');
}
function fuerami(evt) {
	var target = evt.target;
	target.setAttributeNS(null, 'fill', 'rgba(0,255,0,0.1)');
	target.setAttributeNS(null, 'stroke', 'lime');
}
function propiedades4d(objeto) {
	colorfil=objeto.style.fill;
	colorstroke=objeto.style.stroke;
	document.getElementById('ruta').style.stroke=colorstroke;
	document.getElementById('relleno').style.fill=colorfil;
	document.getElementById('atras').style.fill=colorstroke;
}
//mouse mueve
if (window.addEventListener) {document.getElementById('panel4d').addEventListener('mousemove', muevemouse, false);} else {document.getElementById('panel4d').onmousemove = muevemouse;}
function muevemouse(e) {
	if (croping=="1") {	
    	if (!draggingCircle) return;		
    	var rect = document.getElementById('panel4d').getBoundingClientRect();
    	x = e.clientX - rect.left;
    	y = e.clientY - rect.top;
        document.getElementById('circuloz').setAttribute('cx', x);
    	document.getElementById('circuloz').setAttribute('cy', y);
    	marcozoom();
		return;
	}
	e = window.event || e;	var target = e.target;	
	x = parseInt(e.pageX);
	y = parseInt(e.pageY);
	if (dibujando == 1) {curso(); return;}
	if (gotero) {
		chupacolor();
		if (seleccionado) {
			pruta = x + "," + y + " " + (x) + "," + (y - 2) + "," + (x + 7) + "," + (y - 7) + "," + (x + 9) + "," + (y - 5) + "," + (x + 2) + "," + (y) + "," + x + "," + y;
			var pcolor = document.getElementById('pat').style.fill;
			sty = 'fill: ' + pcolor + '; stroke: black; stroke-width: 0.333; stroke-linecap: round; stroke-linejoin: round;';
			poli4d("_gota", pruta, sty);	
			puntos = seleccionado.points;
			var ptos = puntos.numberOfItems;
			var pruta = '';
			for (var incrementador = 0; incrementador < ptos; incrementador++) {
				pruta += puntos.getItem(incrementador).x + "," + puntos.getItem(incrementador).y + " ";
			}
			sty = 'fill: ' + pcolor + '; stroke: ' + pcolor + '; stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;';
			poli4d(seleccionado.id, pruta, sty);
			rehacerfila4d();
		}
	}
	if (moviendoblip) {		
		c4d(x, y, 3, moviendoblip, 'none', 'red', 'panel4d');
		if (seleccionado.nodeName === 'polyline') {
			var puntos = rutaseleccionada;
			var ptos = puntos.numberOfItems;
			var pruta = '';
			for (var incrementador = 0; incrementador < ptos; incrementador++) {
				pruta += puntos.getItem(incrementador).x + "," + puntos.getItem(incrementador).y + " ";
			}
			var pruta1 = pruta.split(puntoanterior).join(x + ',' + y);
			puntoanterior = x + ',' + y;
			poli4d(seleccionado.id, pruta1, ' ');
		}
	}
}
// dobleclic
if (window.addEventListener) {document.getElementById('panel4d').addEventListener('dblclick', dobleclic, false);} else {document.getElementById('panel4d').ondblclick = dobleclic;}
function dobleclic(e) {
	if (seleccionado) {
		e = window.event || e;
		x = parseInt(e.pageX);
		y = parseInt(e.pageY);
		var target = e.target;
		if (target.id.indexOf('__4Dblip') >= 0) {
			puntoanterior = target.cx.animVal.value + ',' + target.cy.animVal.value;
			var puntoinserta = target.cx.animVal.value + ',' + target.cy.animVal.value + ' ' + (target.cx.animVal.value + 2) + ',' + (target.cy.animVal.value - 2);
			puntos = seleccionado.points;
			var ptos = puntos.numberOfItems;
			pruta = '';
			for (var incrementador = 0; incrementador < ptos; incrementador++) {
				pruta += puntos.getItem(incrementador).x + "," + puntos.getItem(incrementador).y + " ";
			}
			var pruta1 = pruta.replace(puntoanterior, puntoinserta);
			poli4d(seleccionado.id, pruta1, ' ');
			quitablips('__4Dblip');
			seleccione(seleccionado);
		}
	}
}
//clic derecho
if (window.addEventListener) {document.getElementById('panel4d').addEventListener('contextmenu', clicdere, false);} else {document.getElementById('panel4d').oncontextmenu = clicdere;}
function clicdere(e) {
	if(dibujando ==1){
		borranterior();
	}
    e.preventDefault();
}
function borranterior(){
	r = r.replace(','+pa, '');
	poli4d(actual, (r + ',' + pix + ',' + piy), sty);
	var puntos = r.split(',');
	if (puntos.length >= 2) {
		pa = puntos[puntos.length - 2] + ',' + puntos[puntos.length - 1];
	}
	curso();
}
//scroll
if (window.addEventListener) {
    document.body.addEventListener('wheel', rueda, false);
    document.body.addEventListener('mousewheel', rueda, false);
    document.body.addEventListener('DOMMouseScroll', rueda, false);
} else {
    document.body.onwheel = rueda;
    document.body.mousewheel = rueda;
    document.body.DOMMouseScroll = rueda;
}
function rueda(e) {
    e = window.event || e;  var target = e.target;
    if (croping=="1") {
        var delta = Math.max(-1, Math.min(1, e.wheelDelta || -e.detail));
        zoom = zoom + delta;
		if(zoom==0){zoom = 1 };
		if(zoom>256){zoom = 256 };
		document.getElementById("sliderzoom").setAttribute('cx', zoom);
        marcozoom();
    }
}
//Salva4d
function salv4d() {
	cier4d();
    if (document.getElementById("circuloz")) {document.getElementById('circuloz').remove();}
    if (document.getElementById("marcolinea")) {document.getElementById('marcolinea').remove();}
	var registro = new Date;
	var fecha = registro.getFullYear() + ('0' + (registro.getMonth() + 1)).slice(-2) + ('0' + registro.getDate()).slice(-2) + ('0' + registro.getHours()).slice(-2) + ('0' + registro.getMinutes()).slice(-2) +  ('0' + registro.getSeconds()).slice(-2) +  ('00' + registro.getMilliseconds()).slice(-3);
	instante  = fecha;
	var nombrearchivo = fecha + "_" + autor + ".htm";
	if (document.getElementById('objetos4d').files[0]) {
		nombrearchivo = document.getElementById('objetos4d').files[0].name;
	}
	if (document.getElementById('imagenes').files[0]) {
		nombrearchivo1 = document.getElementById('imagenes').files[0].name;
		const lastDot = nombrearchivo1.lastIndexOf('.');
		const fileName = nombrearchivo1.substring(0, lastDot);
		const ext = nombrearchivo1.substring(lastDot + 1);
		nombrearchivo = fileName + ".htm";
	}
	dataURL = canvas1.toDataURL("image/png");
	var ps="panel();window.addEventListener('resize',function(event){panel();});function panel(){var lado,resto,pan,id;var ancho=Math.max(document.documentElement.clientWidth,window.innerWidth);var alto=Math.max(document.documentElement.clientHeight,window.innerHeight)-2;if(ancho > alto){lado=alto;resto=ancho-lado;pan='HOR';}else{lado=ancho;resto=alto-lado;pan='VER';}        document.getElementById('panel4d').setAttribute('style','position:absolute;left:0px;top:0px;width:'+ancho+'px;height:'+alto+'px;');document.getElementById('imagen').setAttribute('style','position:absolute;left:0px;top:0px;width:'+ancho+'px;height:'+alto+'px;');    }";
	//"<script>" + ps + "</" + "script>" +
    var htm = "<html><head><title>CuartaDimension</title>" + 
        "<meta name='Autor' content='" + autor  + "'  />" + 
        "<meta name='Topico' content='DataSet4d' />" +       
        "<meta name='Entidad' content='LabSVJJ' />" +
        "<meta name='Instante' content='" + instante  + "' />" +
        "<meta name='Latitud' content='" + latitud  + "' />" +
        "<meta name='Longitud' content='" + longitud + "' />" +
        "<meta name='Altitud' content='" + altitud  + "' />" +      
        "<meta name='keywords' content='Editor SVG Cuarta Dimension' />" + 
        "<meta name='description' content='Lenguaje social gráfico' />" + 
        "<meta name='viewport' content='width=device-width, initial-scale=1.0' />" + 
        "<meta http-equiv='Expires' content='Tue, 25 Abr 1990 09:30:00 -0700' />" +
        "<meta http-equiv='Content-Type' content='text/html;charset=utf-8' />" +
        "<meta http-equiv='encoding' content='utf-8' />" +
        "</head><body style='margin:0;padding:0;'>" +
        "<img id='imagen' style='position:absolute; left:0px;top:0px;width:256px;height:256px;' src='" + dataURL + "'></img>"+
        "<svg style='position:absolute; left:0px;top:0px;width:256px;height:256px;' id='panel4d' preserveAspectRatio='none' viewBox='0 0 256 256'>" +
        document.getElementById('panel4d').innerHTML.trim() +
        "</svg>" +
        "</body></html>";    
	download(htm, nombrearchivo, "htm");
}
function download(data, filename, type) {
	var file = new Blob([data],{type: type});
	if (window.navigator.msSaveOrOpenBlob)
		window.navigator.msSaveOrOpenBlob(file, filename);
	else {
		var a = document.createElement("a")
			, url = URL.createObjectURL(file);
		a.href = url;
		a.download = filename;
		document.body.appendChild(a);
		a.click();
		setTimeout(function() {
			document.body.removeChild(a);
			window.URL.revokeObjectURL(url);
		}, 0);
	}
}
// Dibuja
function poly4d() {
	if (dibujando == 1) {
		x = pix;y = piy; cli();
		dibujando = 0;
		cier4d();
		rehacerfila4d();
		document.getElementById('panel4d').style.cursor = 'default';
		document.getElementById('b2').className.baseVal = "boton";
	} else {
		document.getElementById('b2').className.baseVal = "bactivo";
		limpiar4d();
		dibujando = 1;
		curso();
		document.getElementById('panel4d').style.cursor = 'none';
	}
}
function limpiar4d() {
	quitablips('__4Dblip');
	seleccionado = '';
}
function quitablips(texto) {
	var nodos = document.getElementById("panel4d").childNodes.length - 1;
	for (var incrementador = nodos; incrementador > 0; incrementador--) {
		var objeto = document.getElementById("panel4d").childNodes[incrementador];
		var pid = objeto.id;
		if (pid) {
			if (pid.indexOf(texto) >= 0) {
				document.getElementById("panel4d").removeChild(objeto);
			}
		}
	}
	blip = 0;
}
function curso() {
	var sty = '', cu = '';
	if (dibujando == 1) {
		if (pa !== '') {
			sty = 'fill: none; stroke: red; stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;';
			cu = pa + ',' + x + ',' + y;
			poli4d('_temp', cu, sty);
		}
		sty = 'fill: none; stroke: blue; stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;';
		cu = x - 2 + ',' + (y - 2) + ',' + (x + 2) + ',' + (y - 2) + ',' + (x + 2) + ',' + (y + 2) + ',' + (x - 2) + ',' + (y + 2) + ',' + (x - 2) + ',' + (y - 2);
		poli4d('_curs', cu, sty);
	}
}
function cier4d() {
    moviendotexto='', seleccionado = '', boton = '', dibujando = 0,	k = 0, pi = '',	pa = '';
	quitablips('__4Dblip');
	if (document.getElementById('_curs')) {
		document.getElementById('_curs').remove();
	}
	if (document.getElementById('_temp')) {
		document.getElementById('_temp').remove();
	}
	document.getElementById('panel4d').style.cursor = 'default';
}
function cli() {
	if (dibujando == 1) {
		sty = "fill: " + colorfil + "; stroke: " + colorstroke + "; stroke-width: " + grueso + "; stroke-linecap: round;stroke-linejoin: round;";
		if (pi === '') {
			actual = 'Vector' + conta;
			conta++;
			while (document.getElementById(actual)) {
				actual = 'Vector' + conta;
				conta++;
			}
			pix = x;
			piy = y;
			pi = x + ',' + y;
			pa = pi;
			r = pa;
			poli4d(actual, r, sty);
			seleccionado = document.getElementById(actual);
		} else {
			r = r + ',' + x + ',' + y;
			poli4d(actual, (r + ',' + pix + ',' + piy), sty);
			pa = x + ',' + y;
		}
	}
}
function rehacerfila4d() {
	fila4d = [];
	var j = 0;
	var nodos = document.getElementById("panel4d").childNodes.length;
	for (var incrementador = 0; incrementador < nodos; incrementador++) {
		var objeto = document.getElementById("panel4d").childNodes[incrementador];
		var pid = objeto.id;
		if (pid) {
			if (pid.indexOf('__4Dblip') < 0 && pid.indexOf('_espiral') < 0 && pid.indexOf('_coloralfa') < 0 && pid.indexOf('_colorrojo') < 0 && pid.indexOf('_colorverde') < 0 && pid.indexOf('_colorazul') < 0) {
				if (pid != '_curs' && pid != '_temp') {
					sty = "fill: " + objeto.style.fill + "; stroke: " + objeto.style.stroke + "; stroke-width: " + objeto.style.strokeWidth + "; stroke-linecap: round;stroke-linejoin: round;";
					puntos = objeto.points;
					if (puntos) {
					var ptos = puntos.numberOfItems;
					var pruta = '';
					for (var i = 0; i < ptos; i++) {
						pruta += puntos.getItem(i).x + "," + puntos.getItem(i).y + " ";
					}
					fila4d[j] = j + "|" + "checked|polyline|" + pid + "| | |" + pruta + "|" + sty;
					j++;
					}
				}
			}
		}
	}
}
// colorear o solo el borde del plano
function colorear4d() {
	if (colorear) {
		colorear = false;
		document.getElementById('b4').className.baseVal = "bactivo";
		for (i = 0; i < fila4d.length; i++) {
			array = fila4d[i].split("|");
			if (array[2] === "polyline") {
				if(array[3]!=="marcolinea"){
					var pestilo = array[7].split(";");
					var pfill = pestilo[0].split(":");
					var pcolorfill = pfill[1];
					var pstroke = pestilo[1].split(":");
					var pcolorstroke = pstroke[1];
					sty = 'fill: ' + pcolorstroke + '; stroke: ' + pcolorstroke + '; stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;';
					poli4d(array[3], array[6], sty);
				}
			}
		}
	} else {
		colorear = true;
		document.getElementById('b4').className.baseVal = "boton";
		for (i = 0; i < fila4d.length; i++) {
			array = fila4d[i].split("|");
			if (array[2] === "polyline") {
				var pestilo = array[7].split(";");
				var pfill = pestilo[0].split(":");
				var pcolorfill = pfill[1];
				var pstroke = pestilo[1].split(":");
				var pcolorstroke = pstroke[1];
				sty = 'fill: none; stroke: ' + pcolorstroke + '; stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;';
				poli4d(array[3], array[6], sty);
			}
		}
	}
}
// atras al ultimo plano sel seleccionado
function atras4d() {
	if (seleccionado.id && dibujando == 0) {
		var pid = seleccionado.id;
		var array;
		var fila4dtemp = fila4d;
		var nodos = document.getElementById("panel4d").childNodes.length - 1;
		for (var i = nodos; i >= 0; i--) {
			var obje = document.getElementById("panel4d").childNodes[i];
			document.getElementById("panel4d").removeChild(obje);
		}
		fila4d = [];
		for (i = 0; i < fila4dtemp.length; i++) {
			array = fila4dtemp[i].split("|");
			if (array[3] === pid) {
				fila4d[0] = fila4dtemp[i];
			}
		}
		j=1
		for (i = 0; i < fila4dtemp.length; i++) {
			array = fila4dtemp[i].split("|");
			if (array[3] != pid) {
				fila4d[j] = fila4dtemp[i];
				j++;
			}
		}
		for (i = 0; i < fila4d.length; i++) {
			array = fila4d[i].split("|");
			if (array[2] === "polyline") {
				var pestilo = array[7].split(";");
				var pfill = pestilo[0].split(":");
				var pcolorfill = pfill[1];
				var pstroke = pestilo[1].split(":");
				var pcolorstroke = pstroke[1];
				sty = 'fill: ' + pcolorstroke + '; stroke: ' + pcolorstroke + '; stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;';
				poli4d(array[3], array[6], sty);
			}
		}
		seleccionado = '';
	}
}
//actualiza color
function actualiza4d(pcolor){
	colorstroke=pcolor;
	colorfil="none";
	document.getElementById('ruta').style.stroke=colorstroke;
	document.getElementById('relleno').style.fill=colorstroke;
	document.getElementById('atras').style.fill=colorstroke;
	document.getElementById('pat').style.fill=colorstroke;	
	if (seleccionado.id) {
			puntos = seleccionado.points;
			var ptos = puntos.numberOfItems;
			var pruta = '';
			for (var incrementador = 0; incrementador < ptos; incrementador++) {
				pruta += puntos.getItem(incrementador).x + "," + puntos.getItem(incrementador).y + " ";
			}
			sty = 'fill: ' + pcolor + '; stroke: ' + pcolor + '; stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;';
			poli4d(seleccionado.id, pruta, sty);
			rehacerfila4d();
		}
}
// color pic gotero
function colorpic4d() {
	if (gotero) {
		gotero = false;
		document.getElementById('panel4d').style.cursor = 'default';
		document.getElementById('b3').className.baseVal = "boton";
	} else {
		if(seleccionado && dibujando == 0){
			gotero = true;
			document.getElementById('panel4d').style.cursor = 'none';
			document.getElementById('b3').className.baseVal = "bactivo";
		}
	}
}
function chupacolor() {
	var rojo = canvas4d.getImageData(x, y, 1, 1).data[0];
	var verde = canvas4d.getImageData(x, y, 1, 1).data[1];
	var azul = canvas4d.getImageData(x, y, 1, 1).data[2];
	var alfa = canvas4d.getImageData(x, y, 1, 1).data[3];
	rojo = (rojo < 16 ? "0" : "") + rojo.toString(16).toUpperCase();
	verde = (verde < 16 ? "0" : "") + verde.toString(16).toUpperCase();
	azul = (azul < 16 ? "0" : "") + azul.toString(16).toUpperCase();
	alfa = (alfa < 16 ? "0" : "") + alfa.toString(16).toUpperCase();
	colorchupado = "#" + rojo + verde + azul + alfa;
	actualiza4d(colorchupado);
}
//lee archivo .htm
function leeXML() {
	var archivo = document.getElementById('objetos4d').files[0];
	var lector = new FileReader();
	lector.addEventListener("load", function() {
		parser = new DOMParser();
		xmlDoc = parser.parseFromString(lector.result, "text/xml");
		var ti = xmlDoc.getElementById("imagen");
		if (ti && ti.getAttribute("src")) {
     	   var imageSrc = ti.getAttribute("src");
           var img = new Image();
        	img.onload = function() {
            	canvas4d.drawImage(img, 0, 0, 256, 256, 0, 0, 256, 256);
            	canvas24d.drawImage(img, 0, 0, 256, 256, 0, 0, 32, 32);
        	};
        img.src = imageSrc;
    	}
		if (document.getElementById("b1")) {document.getElementById('b1').remove();}
		AnalizaXML(xmlDoc);
	}, false);
	if (archivo) {
		lector.readAsText(archivo);
	}
}
function AnalizaXML(xmlDoc) {
	arregloXML(xmlDoc);
	dibujaXML();
}
function arregloXML(xmlDoc) {
	var tg = xmlDoc.getElementsByTagName("svg")[0].childNodes;
	var objetos = (fila4d.length);
	for (i = 0; i < tg.length; i++) {
		if (tg[i]) {
			fila4d[i + objetos] = i + "|" + "checked|" + tg[i].nodeName + "|" + tg[i].getAttribute('id') + "|";
			if (tg[i].nodeName === "polyline") {
				fila4d[i + objetos] += " | |" + tg[i].getAttribute('points') + "|";
			}
			fila4d[i + objetos] += tg[i].getAttribute('style');
		}
	}
}
function dibujaXML() {
	var array;
	for (i = 0; i < fila4d.length; i++) {
		array = fila4d[i].split("|");
		if (array[2] === "polyline") {
			poli4d(array[3], array[6], array[7]);
		}
	}
}
//inicio
window.addEventListener("DOMContentLoaded", function (event) {licencia();});
function getMeta(name) {
    var meta = document.querySelector('meta[name="' + name + '"]');
    return meta ? meta.getAttribute('content') : '';
 }
function licencia(){
	latitud = getMeta('Latitud');
	longitud = getMeta('Longitud');
	altitud = getMeta('Altitud');
	instante = getMeta('Instante');
	autor = getMeta('Autor');
	var ubicacion = [latitud, longitud, altitud, instante].filter(Boolean).join(',');
	var ubicacion4d = document.getElementById('ubicacion4d');
	if (ubicacion4d) ubicacion4d.textContent = ubicacion;
	var autor4d = document.getElementById('autor4d');
	if (autor4d) autor4d.textContent = autor;
}
//imagen a canvas
function recorta(){
	var archivo = document.getElementById('imagenes').files[0];
	if (archivo) {
		var lector = new FileReader();
		lector.readAsDataURL(archivo);
		lector.onloadend = function() {document.getElementById("imagen").src = lector.result;};
		document.getElementById("imagen").onload = function() {
			if (document.getElementById("bimagen")) {document.getElementById('bimagen').remove();}
			document.getElementById("circuloz").style.display = 'block';
			document.getElementById("marcolinea").style.display = 'block';
			document.getElementById("sliderzoom").style.display = 'block';
			document.getElementById("sliderbase").style.display = 'block';
			const svgRect = document.getElementById("panel4d").getBoundingClientRect(); 
			var offsetX = svgRect.left; 
			var offsetY = svgRect.top;  
			var a = svgRect.width;
			var an = 0 , al = 0 ;
			x = 128, y = 128;
			var anchoi = document.getElementById("imagen").width;
			var altoi  = document.getElementById("imagen").height;
			var ra = anchoi / altoi;
			if (ra != 1 && anchoi != a) {
				if (ra > 1) {
					an = a;
					al = parseInt(a / ra);
					dy = parseInt((a - al) / 2);
					dx = 0;
					factor = (anchoi/a);
				} else {
					an = parseInt(a * ra);
					al = a;
					dy = 0;
					dx = parseInt((a - an) / 2);
					factor = (altoi/a) ;
				}
				document.getElementById("imagen").width = an;
				document.getElementById("imagen").height = al;
				document.getElementById("imagen").style.top = (32+dy) + 'px';
				document.getElementById("imagen").style.left = dx + 'px';				
				croping = "1";
				marcozoom();
			} else {
				document.getElementById("imagen").width = 256;
				document.getElementById("imagen").height = 256;
				document.getElementById("imagen").style.top = '0px';
				document.getElementById("imagen").style.left = '0px';
                marcozoom();
				cropiar();
			}
		}
	}	
}
function marcozoom(){
	pruta = (x - zoom) + ',' + (y - zoom) + ',' + (x + zoom) + ',' + (y - zoom) + ',' + (x + zoom) + ',' + (y + zoom) + ',' + (x - zoom) + ',' + (y + zoom) + ',' + (x - zoom) + ',' + (y - zoom);
	poli4d("marcolinea", pruta, 'fill: none; stroke: lime; stroke-width: 1; stroke-linecap: round; stroke-linejoin: round; stroke-dasharray: 5,5 ;');
	muestrazoom();
}
function muestrazoom() {
	x0 = parseInt(((x - dx) - zoom) * factor);
	x1 = parseInt(((x - dx) + zoom) * factor) - x0;
	y0 = parseInt(((y - dy) - zoom) * factor);
	y1 = parseInt(((y - dy) + zoom) * factor) - y0;
	canvas4d.fillStyle  = "rgb(224,224,224)"; canvas4d.fillRect(0, 0, 256, 256); canvas4d.fill();
	canvas4d.drawImage(document.getElementById("imagen"), x0, y0, x1, y1, 0, 0, 256, 256);
    canvas24d.fillStyle = "rgb(224,224,224)"; canvas24d.fillRect(0, 0, 64, 64);  canvas24d.fill();
    canvas24d.drawImage(document.getElementById("imagen"), x0, y0, x1, y1, 0, 0, 32, 32);
    canvas24d.beginPath();
    canvas24d.arc(16, 16, 15, 0, 2 * Math.PI);
    canvas24d.strokeStyle = "lime";
    canvas24d.lineWidth = 1;
    canvas24d.stroke();
}
function cropiar() {
	croping = "0";
    document.getElementById("slider4d").style.display = 'none';
    if (document.getElementById("circuloz")) {document.getElementById('circuloz').remove();}
    if (document.getElementById("marcolinea")) {document.getElementById('marcolinea').remove();}
    if (document.getElementById("imagen")) {document.getElementById('imagen').remove();}
}
function suiche4d(pid) {
    if (croping=="1") {
        cropiar();
    } else {
        if (document.getElementById(pid).style.display == "block" || document.getElementById(pid).style.display == "undefined") {document.getElementById(pid).style.display = "none";} else {document.getElementById(pid).style.display = "block";}
    }
}
//funciones
function poli4d(pid, pts, sty) {if (pts.indexOf("undefined")<0 && pts.indexOf("NaN")<0){var o4d; if (document.getElementById(pid)) {o4d = document.getElementById(pid);} else {o4d = document.createElementNS("http://www.w3.org/2000/svg", "polyline"); o4d.setAttribute("id", pid); o4d.setAttribute("shape-rendering", "geometricPrecision"); } o4d.setAttribute("points", pts);if (sty !== " ") {o4d.setAttribute("style", sty);}if (!document.getElementById(pid)) {document.getElementById("panel4d").appendChild(o4d);}}}
</script>
</body>
</html>