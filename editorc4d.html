<!DOCTYPE html>
<html lang="es" xmlns="http://www.w3.org/1999/xhtml">
<head>
<!--Obra : EditorC4D : Software para ilustrar en la Web, Autor: Jorge Julian Sanchez Velez, DNDA: Registro nacional de Derechos de autor Libro 13 Tomo 32 Partida 433 20120320 -->
<title>EditorC4D</title>
<meta       name = "viewport"     content = "width=device-width, initial-scale=1.0">
<meta       name = "Autor"        content = "jorge4d"/>
<meta       name = "Latitud"      content = "6.2529001235962"/>
<meta       name = "Longitud"     content = "-75.564598083496"/>
<meta       name = "Altitud"      content = "3000.00"/>
<meta       name = "Momento"      content = "2024/09/20_11:57:00"/>
<meta       name = "Email"        content = "labsvjj@gmail.com"/>
<meta       name = "keywords"     content = "Editor SVG Cuarta Dimension America4D"/>
<meta       name = "description"  content = "Plataforma de interaccion vectorial"/>
<meta http-equiv = "Expires"      content = "Tue, 25 Abr 1990 09:30:00 -0700"/>
<meta http-equiv = "Content-Type" content = "text/html;charset=utf-8"/>
<meta http-equiv = "encoding"     content = "utf-8"/>
<style>.boton       {background-color: #d7d7d7;}.boton:hover {background-color: rgb(128,128,128);}.bactivo     {background-color: yellow;}</style>
</head>
<body>
<input  id="imagenes"   style="display:none;" type="file" onChange="recorta();" size="1" name="imagenes" />
<input  id="objetos4d"  style="display:none;" type="file" onChange="leeXML();" />
<img    id="im"         style="display: block; position:absolute; top: 0px;  left: 0px;"/>
<canvas id='myCanvas4D' style="background-color: white; position: absolute; display: block; left: 0px; top: 0px; width: 512px; height: 512px;" width='512px' height='512px'></canvas>
<canvas id='canvas64'   style="background-color: #d7d7d7; position: absolute; left: 512px; top: 256px; width: 64px; height: 64px; cursor:pointer; cursor:hand; " onclick="suiche4d('myCanvas4D')" width='64px' height='64px'></canvas>
<svg    id="panel4d"    style="outline: #C0C0C0FF solid 1px; position: absolute; left: 0px; top: 0px; width: 512px; height: 512px;" viewBox="0 0 512 512" preserveAspectRatio="none"></svg>
<svg    id="bcolor"     style="position: absolute; width: 64px; height: 64px; top: 0px; left: 512px;">
	<a href="#" onclick="actualiza4d('yellow'); return false;"><polyline style="fill: yellow; stroke: yellow;  stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="4,4 28,4 28,14 4,14 4,4"></polyline></a>	
	<a href="#" onclick="actualiza4d('orange'); return false;"><polyline style="fill: orange; stroke: orange;  stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="4,16 28,16 28,26 4,26 4,16"></polyline></a>
	<a href="#" onclick="actualiza4d('red'); return false;"><polyline style="fill: red;    stroke: red;     stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="4,28 28,28 28,38 4,38 4,28"></polyline></a>
	<a href="#" onclick="actualiza4d('brown'); return false;"><polyline style="fill: brown;  stroke: brown;   stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="4,40 28,40 28,50 4,50 4,40"></polyline></a>
	<a href="#" onclick="actualiza4d('black'); return false;"><polyline style="fill: black;  stroke: black;   stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="4,52 28,52 28,62 4,62 4,52"></polyline></a>
	<a href="#" onclick="actualiza4d('white'); return false;"><polyline style="fill: white;  stroke: white;   stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="32,4 60,4 60,14 32,14 32,4"></polyline></a>
	<a href="#" onclick="actualiza4d('gray'); return false;"><polyline style="fill: gray;   stroke: gray;    stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="32,16 60,16 60,26 32,26 32,16"></polyline></a>
	<a href="#" onclick="actualiza4d('purple'); return false;"><polyline style="fill: purple; stroke: purple;  stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="32,28 60,28 60,38 32,38 32,28"></polyline></a>
	<a href="#" onclick="actualiza4d('blue'); return false;"><polyline style="fill: blue;   stroke: blue;    stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="32,40 60,40 60,50 32,50 32,40"></polyline></a>
	<a href="#" onclick="actualiza4d('green'); return false;"><polyline style="fill: green;  stroke: green;   stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="32,52 60,52 60,62 32,62 32,52"></polyline></a>
</svg>
<svg    id="b2" onclick="poly4d()"     class="boton" viewBox="0 0 64 64"   style="cursor: pointer;cursor: hand; position: absolute; width: 64px; height: 64px; top: 64px; left: 512px;">
    <polyline style="fill: black; stroke: black;  stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="64,0 60,4 60,59 64,64 59,60 4,60 0,64 64,64 64,0"></polyline>
    <polyline id="pol" style="fill: white; stroke: white;  stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="4,4 59,4 59,59 4,59 4,4"></polyline>
    <polyline id="ruta" points="14,22 33,12 50,32 40,50 22,46 14,22" style="fill: none; stroke: black; stroke-width: 1;"></polyline>
    <polyline points="12,20 15,20 15,24 12,24  12,20" style="fill: none; stroke: blue; stroke-width: 1;"></polyline>
</svg>
<svg    id="b4" onclick="colorear4d()" class="boton" viewBox="0 0 64 64"   style="cursor: pointer;cursor: hand; position: absolute; width: 64px; height: 64px; top: 128px; left: 512px;">
    <polyline style="fill: black; stroke: black;  stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="64,0 60,4 60,59 64,64 59,60 4,60 0,64 64,64 64,0"></polyline>
    <polyline style="fill: white; stroke: white;  stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="4,4 59,4 59,59 4,59 4,4"></polyline>
    <polyline id="relleno" style="fill: black; stroke: black;  stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="16,16 26,16 26,26 16,26 16,16"></polyline>
    <polyline id="esqueleto" style="fill: none; stroke: black;  stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="34,32 44,32 44,42 34,42 34,32"></polyline>
</svg>
<svg    id="b5" onclick="atras4d()"    class="boton" viewBox="0 0 64 64"   style="cursor: pointer;cursor: hand; position: absolute; width: 64px; height: 64px; top: 192px; left: 512px;">
    <polyline style="fill: black; stroke: black;  stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="64,0 60,4 60,59 64,64 59,60 4,60 0,64 64,64 64,0"></polyline>
    <polyline style="fill: white; stroke: white;  stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="4,4 59,4 59,59 4,59 4,4"></polyline>
    <polyline id="atras" style="fill: black; stroke: none;  stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="16,16 52,16 52,52 16,52 16,16"></polyline>
    <polyline style="fill: white; stroke: black;  stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="12,12 48,12 48,48 12,48 12,12"></polyline>
</svg>
<svg    id="b1" onclick="imagen4d()"   class="boton" viewBox="0 0 64 64"   style="cursor: pointer;cursor: hand; position: absolute; width: 64px; height: 64px; top: 256px; left: 512px;">
    <g id="gimagen" style="display: block;">
        <polyline style="fill: black; stroke: black;  stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="64,0 60,4 60,59 64,64 59,60 4,60 0,64 64,64 64,0"></polyline>
        <polyline style="fill: blue;  stroke: blue;   stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="4,4 59,4 59,32 4,32 4,4"></polyline>
        <polyline style="fill: green; stroke: green;  stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="4,32 24,14 59,59 4,59 4,32"></polyline>
        <polyline style="fill: lime;  stroke: lime;   stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="4,59 50,20 59,32 59,59 4,59"></polyline>
        <circle cx='36' cy='10' r='4' style='stroke-width: 2; stroke: orange; fill: yellow;'></circle>
    </g>
</svg>
<svg    id="b3" onclick="colorpic4d()" class="boton" viewBox="0 0 64 64"   style="cursor: pointer;cursor: hand; position: absolute; width: 64px; height: 64px; top: 320px; left: 512px;">
    <polyline style="fill: black; stroke: black;  stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="64,0 60,4 60,59 64,64 59,60 4,60 0,64 64,64 64,0"></polyline>
    <polyline style="fill: white; stroke: white;  stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="4,4 59,4 59,59 4,59 4,4"></polyline>
    <polyline id="pat" style="fill: none; stroke: black;  stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="14,14 50,14 50,50 14,50 14,14"></polyline>
    <polyline style="fill: none; stroke: black;  stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="32,22,32,20,39,13,41,15,34,22,32,22"></polyline>
    <polyline style="fill: blue; stroke: blue;  stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="45,9 45,12 43,14 43,16 42,17 37,12 38,11 39,11 42,8 45,9 "></polyline>
</svg>
<svg    id="b6" onclick="abrir4d()"    class="boton" viewBox="0 0 64 64"   style="cursor: pointer;cursor: hand; position: absolute; width: 64px; height: 64px; top: 384px; left: 512px;">
    <polyline style="fill: black; stroke: black;  stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="64,0 60,4 60,59 64,64 59,60 4,60 0,64 64,64 64,0"></polyline>
    <polyline style="fill: white; stroke: white;  stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="4,4 59,4 59,59 4,59 4,4"></polyline>
    <polyline style="fill: none; stroke: black;  stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="14,50 50,50 50,56 14,56 14,50"></polyline>
    <polyline style="fill: none; stroke: black;  stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="32,6 50,26 40,26 40,46 24,46 24,26 14,26 32,6"></polyline>
</svg>
<svg    id="b7" onclick="salv4d()"     class="boton" viewBox="0 0 64 64"   style="cursor: pointer;cursor: hand; position: absolute; width: 64px; height: 64px; top: 448px; left: 512px;">
    <polyline style="fill: black; stroke: black;  stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="64,0 60,4 60,59 64,64 59,60 4,60 0,64 64,64 64,0"></polyline>
    <polyline style="fill: white; stroke: white;  stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="4,4 59,4 59,59 4,59 4,4"></polyline>
    <polyline style="fill: none; stroke: black;  stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="14,50 50,50 50,56 14,56 14,50"></polyline>
    <polyline style="fill: none; stroke: black;  stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;" points="32,46 14,28 24,28 24,6 40,6 40,28 50,28 32,46"></polyline>
</svg>
<script>
var colores = ['black', 'brown', 'red', 'orange', 'yellow', 'green', 'blue', 'purple', 'gray', 'white'];
var contadordecolores = 0;
var x = 256, y = 256, z= 4, tiempo=1;
var anchocan = 512, zoom = 32, croping = "", factor, dx, dy;
var dibujando = 0, r, pa = '', pi = '', conta = 0, contatext=0;
var moviendoblip, seleccionado, rutaseleccionada, colorfil = 'none', colorstroke = '#000000', grueso = '1';
var gotero = false, intro = false, colorear = true;
var k = 0, puntos = '', sty = '';
var fila4d = [], array;
var canvas1 = document.getElementById("myCanvas4D");
var canvas4d = canvas1.getContext("2d");
var canvas2 = document.getElementById("canvas64");
var canvas24d = canvas2.getContext("2d");
var imageObj = document.getElementById('im') , fileName = "objeto4d";
if (window.addEventListener) {
    document.getElementById('panel4d').addEventListener('mousemove', muevemouse, false);
    document.getElementById('panel4d').addEventListener('wheel', rueda, false);
    document.getElementById('panel4d').addEventListener('mousewheel', rueda, false);
    document.getElementById('panel4d').addEventListener('DOMMouseScroll', rueda, false);
    document.getElementById('panel4d').addEventListener('dblclick', dobleclic, false);
    document.getElementById('panel4d').addEventListener('contextmenu', clicdere, false);
    document.getElementById('panel4d').addEventListener('click', clicmouse, false);
} else {
    document.getElementById('panel4d').onmousemove = muevemouse;
    document.getElementById('panel4d').onwheel = rueda;
    document.getElementById('panel4d').mousewheel = rueda;
    document.getElementById('panel4d').DOMMouseScroll = rueda;
    document.getElementById('panel4d').ondblclick = dobleclic;
    document.getElementById('panel4d').oncontextmenu = clicdere;
    document.getElementById('panel4d').onclick = clicmouse;
}
function salv4d() {
	cier4d();
	var registro = new Date;
	var fecha = registro.getFullYear() + ('0' + (registro.getMonth() + 1)).slice(-2) + ('0' + registro.getDate()).slice(-2) + ('0' + registro.getHours()).slice(-2) + ('0' + registro.getMinutes()).slice(-2) +  ('0' + registro.getSeconds()).slice(-2) +  ('00' + registro.getMilliseconds()).slice(-3);
	var pautor  = "labSVJJ", platitud  = "6.2529001235962", plongitud = "-75.564598083496", paltitud  = "1600.00", pinstante  = "2024/07/17_09:36:00", pfechanac  = "1964/02/08";
	var nombrearchivo = fecha + "_" + pautor + ".htm";
	if (document.getElementById('objetos4d').files[0]) {
		nombrearchivo = document.getElementById('objetos4d').files[0].name;
	}
	if (document.getElementById('imagenes').files[0]) {
		nombrearchivo1 = document.getElementById('imagenes').files[0].name;
		const lastDot = nombrearchivo1.lastIndexOf('.');
		const fileName = nombrearchivo1.substring(0, lastDot);
		const ext = nombrearchivo1.substring(lastDot + 1);
		nombrearchivo = fileName + ".htm";
	}
	dataURL = canvas1.toDataURL("image/png");
	var ps="panel();window.addEventListener('resize',function(event){panel();});function panel(){var lado,resto,pan,id;var ancho=Math.max(document.documentElement.clientWidth,window.innerWidth);var alto=Math.max(document.documentElement.clientHeight,window.innerHeight)-2;if(ancho > alto){lado=alto;resto=ancho-lado;pan='HOR';}else{lado=ancho;resto=alto-lado;pan='VER';}        document.getElementById('panel4d').setAttribute('style','position:absolute;left:0px;top:0px;width:'+ancho+'px;height:'+alto+'px;');document.getElementById('imagen').setAttribute('style','position:absolute;left:0px;top:0px;width:'+ancho+'px;height:'+alto+'px;');    }";
    var htm = "<html><head><title>"  + pautor  + "</title>" + "<meta name='Autor' content='Agente4D' />" + "<meta name='Topico' content='train4d' />" +       "<meta name='Entidad' content='SVJJ' />" +
        "<meta name='lat' content='" + platitud  + "' />" +
        "<meta name='lon' content='" + plongitud + "' />" +
        "<meta name='alt' content='" + paltitud  + "' />" +
        "<meta name='tim' content='" + fecha     + "' />" +
        "<meta name='nac' content='" + pfechanac + "' />" +
        "</head><body style='margin:0;padding:0;'>" +
        "<img id='imagen' style='position:absolute; left:0px;top:0px;width:512px;height:512px;' src='" + dataURL + "'></img>"+
        "<svg style='position:absolute; left:0px;top:0px;width:512px;height:512px;' id='panel4d' preserveAspectRatio='none' viewBox='0 0 512 512'>" +
        document.getElementById('panel4d').innerHTML.trim() +
        "</svg>" +
		"<script>" + ps + "</" + "script>" +
        "</body></html>";    
	download(htm, nombrearchivo, "htm");
}
function download(data, filename, type) {
	var file = new Blob([data],{
		type: type
	});
	if (window.navigator.msSaveOrOpenBlob)
		window.navigator.msSaveOrOpenBlob(file, filename);
	else {
		var a = document.createElement("a")
			, url = URL.createObjectURL(file);
		a.href = url;
		a.download = filename;
		document.body.appendChild(a);
		a.click();
		setTimeout(function() {
			document.body.removeChild(a);
			window.URL.revokeObjectURL(url);
		}, 0);
	}
}
function abrir4d() {
	document.getElementById('objetos4d').click();
}
function leeXML() {
	var archivo = document.getElementById('objetos4d').files[0];
	var lector = new FileReader();
	lector.addEventListener("load", function() {
		parser = new DOMParser();
		xmlDoc = parser.parseFromString(lector.result, "text/xml");
		var ti = xmlDoc.getElementById("imagen");
		document.getElementById('b1').remove();
		document.getElementById('im').style.display = 'block';
		document.getElementById('im').width = '512px';
		document.getElementById('im').height = '512px';
		document.getElementById('im').style.top = '0px';
		document.getElementById('im').style.left = '0px';
		document.getElementById('im').src = ti.getAttribute('src');
		canvas4d.drawImage(imageObj, 0, 0, 512, 512, 0, 0, 512, 512);
		canvas24d.drawImage(imageObj, 0, 0, 512, 512, 0, 0, 64, 64);

		AnalizaXML(xmlDoc);
	}, false);
	if (archivo) {
		lector.readAsText(archivo);
	}
}
function AnalizaXML(xmlDoc) {
	arregloXML(xmlDoc);
	dibujaXML();
}
function arregloXML(xmlDoc) {
	var tg = xmlDoc.getElementsByTagName("svg")[0].childNodes;
	var objetos = (fila4d.length);
	for (i = 0; i < tg.length; i++) {
		if (tg[i]) {
			fila4d[i + objetos] = i + "|" + "checked|" + tg[i].nodeName + "|" + tg[i].getAttribute('id') + "|";
			if (tg[i].nodeName === "polyline") {
				fila4d[i + objetos] += " | |" + tg[i].getAttribute('points') + "|";
			}
			fila4d[i + objetos] += tg[i].getAttribute('style');
		}
	}
}
function dibujaXML() {
	var array;
	for (i = 0; i < fila4d.length; i++) {
		array = fila4d[i].split("|");
		if (array[2] === "polyline") {
			poli4d(array[3], array[6], array[7]);
		}
	}
}
function imagen4d() {
	canvas1.style.left = "576px";
	document.getElementById('imagenes').click();
}
function recorta() {
    document.getElementById('b1').remove();
    document.getElementById('myCanvas4D').display = "block";
    var archivo = document.getElementById('imagenes').files[0];
    if (archivo) {
        var lector = new FileReader();
        lector.readAsDataURL(archivo);
        lector.onloadend = function() {document.getElementById('im').src = lector.result;};
        document.getElementById('im').onload = function() {
            var an = 0 , al = 0 , a = 512;
            var anchoi = document.getElementById('im').width;
            var altoi = document.getElementById('im').height;
            var ra = anchoi / altoi;
            if (ra != 1 && anchoi != a) {
                croping = "1";
                document.getElementById('panel4d').style.cursor = 'none';
                if (ra > 1) {
                    an = a;
                    al = parseInt(a / ra);
                    zan = parseInt(512 * (a / anchoi));
                    zal = zan;
                    factor = anchoi / an;
                    dy = parseInt((a - al) / 2);
                    dx = 0;
                } else {
                    an = parseInt(a * ra);
                    al = a;
                    zal = parseInt(512 * (a / altoi));
                    zan = zal;
                    factor = altoi / al;
                    dy = 0;
                    dx = parseInt((a - an) / 2);
                }
                zoom = parseInt(zan / 2);
                document.getElementById('im').style.display = 'block';
                document.getElementById('im').width = an;
                document.getElementById('im').height = al;
                document.getElementById('im').style.top = dy + 'px';
                document.getElementById('im').style.left = dx + 'px';
                muestrazoom();
            } else {
                document.getElementById('im').width = a;
                document.getElementById('im').height = a;
                document.getElementById('im').style.top = '0px';
                document.getElementById('im').style.left = '0px';
                canvas4d.drawImage(imageObj, 0, 0, anchoi, altoi, 0, 0, 512, 512);
                canvas24d.drawImage(imageObj, 0, 0, anchoi, altoi, 0, 0, 64, 64);
                cropiado();
            }
        }
    }
}
function muestrazoom() {
    var sty = 'fill: none; stroke: lime; stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;';
    var pruta = x - zoom + ',' + (y - zoom) + ',' + (x + zoom) + ',' + (y - zoom) + ',' + (x + zoom) + ',' + (y + zoom) + ',' + (x - zoom) + ',' + (y + zoom) + ',' + (x - zoom) + ',' + (y - zoom);
    poli4d("crop", pruta, sty);
    pruta = x + ',' + (y - 5) + ', ' + x + ',' + (y - 2);
    poli4d("fu", pruta, sty);
    pruta = x + ',' + (y + 5) + ', ' + x + ',' + (y + 2);
    poli4d("fd", pruta, sty);
    pruta = (x - 5) + ',' + y + ', ' + (x - 2) + ',' + y;
    poli4d("fl", pruta, sty);
    pruta = (x + 5) + ',' + y + ', ' + (x + 2) + ',' + y;
    poli4d("fr", pruta, sty);
    canvas4d.fillStyle = "rgb(128,128,128)";
    canvas4d.fillRect(0, 0, anchocan, anchocan);
    canvas4d.fill();
    canvas24d.fillStyle = "rgb(128,128,128)";
    canvas24d.fillRect(0, 0, 64, 64);
    canvas24d.fill();
    x0 = parseInt(((x - dx) - zoom) * factor);
    x1 = parseInt(((x - dx) + zoom) * factor) - x0;
    y0 = parseInt(((y - dy) - zoom) * factor);
    y1 = parseInt(((y - dy) + zoom) * factor) - y0;
    canvas4d.drawImage(imageObj, x0, y0, x1, y1, 0, 0, anchocan, anchocan);
    canvas24d.drawImage(imageObj, x0, y0, x1, y1, 0, 0, 64, 64);
}
function cropiado() {
    croping = "";
    canvas1.style.left = "0px";
    canvas1.style.top = "0px";
    document.getElementById("im").remove();
    document.getElementById('panel4d').style.cursor = 'default';
    if (document.getElementById("crop")) {document.getElementById("crop").remove();}
    if (document.getElementById("fu")) {document.getElementById("fu").remove();}
    if (document.getElementById("fd")) {document.getElementById("fd").remove();}
    if (document.getElementById("fl")) {document.getElementById("fl").remove();}
    if (document.getElementById("fr")) {document.getElementById("fr").remove();}
}
function atras4d() {
	if (seleccionado && dibujando === 0) {
		var pid = seleccionado.id;
		var array;
		var fila4dtemp = fila4d;
		var nodos = document.getElementById("panel4d").childNodes.length - 1;
		for (var i = nodos; i >= 0; i--) {
			var obje = document.getElementById("panel4d").childNodes[i];
			document.getElementById("panel4d").removeChild(obje);
		}
		fila4d = [];
		for (i = 0; i < fila4dtemp.length; i++) {
			array = fila4dtemp[i].split("|");
			if (array[3] === pid) {
				fila4d[0] = fila4dtemp[i];
			}
		}
		j=1
		for (i = 0; i < fila4dtemp.length; i++) {
			array = fila4dtemp[i].split("|");
			if (array[3] != pid) {
				fila4d[j] = fila4dtemp[i];
				j++;
			}
		}
		for (i = 0; i < fila4d.length; i++) {
			array = fila4d[i].split("|");
			if (array[2] === "polyline") {
				var pestilo = array[7].split(";");
				var pfill = pestilo[0].split(":");
				var pcolorfill = pfill[1];
				var pstroke = pestilo[1].split(":");
				var pcolorstroke = pstroke[1];
				sty = 'fill: ' + pcolorstroke + '; stroke: ' + pcolorstroke + '; stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;';
				poli4d(array[3], array[6], sty);
			}
		}
		seleccionado = '';
	}
}
function colorear4d() {
	if (colorear) {
		colorear = false;
		document.getElementById('b4').className.baseVal = "bactivo";
		for (i = 0; i < fila4d.length; i++) {
			array = fila4d[i].split("|");
			if (array[2] === "polyline") {
				var pestilo = array[7].split(";");
				var pfill = pestilo[0].split(":");
				var pcolorfill = pfill[1];
				var pstroke = pestilo[1].split(":");
				var pcolorstroke = pstroke[1];
				sty = 'fill: ' + pcolorstroke + '; stroke: ' + pcolorstroke + '; stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;';
				poli4d(array[3], array[6], sty);
			}
		}
	} else {
		colorear = true;
		document.getElementById('b4').className.baseVal = "boton";
		for (i = 0; i < fila4d.length; i++) {
			array = fila4d[i].split("|");
			if (array[2] === "polyline") {
				var pestilo = array[7].split(";");
				var pfill = pestilo[0].split(":");
				var pcolorfill = pfill[1];
				var pstroke = pestilo[1].split(":");
				var pcolorstroke = pstroke[1];
				sty = 'fill: none; stroke: ' + pcolorstroke + '; stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;';
				poli4d(array[3], array[6], sty);
			}
		}
	}
}
function cli() {
	if (dibujando === 1) {
		sty = "fill: " + colorfil + "; stroke: " + colorstroke + "; stroke-width: " + grueso + "; stroke-linecap: round;stroke-linejoin: round;";
		if (pi === '') {
			actual = 'Vector' + conta;
			conta++;
			while (document.getElementById(actual)) {
				actual = 'Vector' + conta;
				conta++;
			}
			pix = x;
			piy = y;
			pi = x + ',' + y;
			pa = pi;
			r = pa;
			poli4d(actual, r, sty);
			seleccionado = document.getElementById(actual);
		} else {
			r = r + ',' + x + ',' + y;
			poli4d(actual, r, sty);
			pa = x + ',' + y;
		}
	}
}
function seleccione(objetivo) {
	limpiar4d();
	if (objetivo.nodeName !== 'svg') {
		seleccionado = objetivo;
		if (objetivo.nodeName === 'text') {
			SVGRect=seleccionado.getBBox();
			sty='fill:none; stroke-width:1;stroke: lime;';
			rect4d('__4Drect', SVGRect.x, SVGRect.y, SVGRect.width, SVGRect.height, 3, 3, sty);
			propiedades4d(seleccionado);
		}
		if (objetivo.nodeName === 'circle') {
		}
		if (objetivo.nodeName === 'polyline') {
			rutaseleccionada = objetivo.points;
			colorfil = objetivo.style.fill;
			colorstroke = objetivo.style.stroke;
			if (colorstroke == 'rgb(0, 0, 0)') {
				colorstroke = '#000000'
			}
			grueso = objetivo.style.strokeWidth;
			poneblips('__4Dblip', objetivo.points, 'lime');
			propiedades4d(seleccionado);
		}
	}
}
function muevemouse(e) {
	e = window.event || e;
	x = parseInt(e.pageX);
	y = parseInt(e.pageY);
	var target = e.target;
	if (!seleccionado) {
		if (e.target.getAttributeNS(null, "id") != 'panel4d' && e.target.getAttributeNS(null, "id") != '_curs' && e.target.getAttributeNS(null, "id") != '_temp') {
			if (e.target.getAttributeNS(null, "id").indexOf('__4Dblip') < 0) {
				
			}
		}
	}
	if (dibujando === 1) {
		curso();
	}
	if (moviendoblip) {
		c4d(x, y, 4.5, moviendoblip, 'none', 'red', 'panel4d');
		if (seleccionado.nodeName === 'polyline') {
			var puntos = rutaseleccionada;
			var ptos = puntos.numberOfItems;
			var pruta = '';
			for (var incrementador = 0; incrementador < ptos; incrementador++) {
				pruta += puntos.getItem(incrementador).x + "," + puntos.getItem(incrementador).y + " ";
			}
			var pruta1 = pruta.replace(puntoanterior, x + ',' + y);
			puntoanterior = x + ',' + y;
			poli4d(seleccionado.id, pruta1, ' ');
		}
	}
	if (croping) {
		muestrazoom();
	}
	if (gotero) {
		chupacolor();
		pruta = x + "," + y + " " + (x) + "," + (y - 2) + "," + (x + 7) + "," + (y - 7) + "," + (x + 9) + "," + (y - 5) + "," + (x + 2) + "," + (y) + "," + x + "," + y;
		var pcolor = document.getElementById('pat').style.fill;
		sty = 'fill: ' + pcolor + '; stroke: black; stroke-width: 0.333; stroke-linecap: round; stroke-linejoin: round;';
		poli4d("_gota", pruta, sty);
		if (seleccionado) {
			puntos = seleccionado.points;
			var ptos = puntos.numberOfItems;
			var pruta = '';
			for (var incrementador = 0; incrementador < ptos; incrementador++) {
				pruta += puntos.getItem(incrementador).x + "," + puntos.getItem(incrementador).y + " ";
			}
			sty = 'fill: ' + pcolor + '; stroke: ' + pcolor + '; stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;';
			poli4d(seleccionado.id, pruta, sty);
			rehacerfila4d();
		}
	}
}
function dobleclic(e) {
	if (seleccionado) {
		e = window.event || e;
		x = parseInt(e.pageX);
		y = parseInt(e.pageY);
		var target = e.target;
		if (target.id.indexOf('__4Dblip') >= 0) {
			puntoanterior = target.cx.animVal.value + ',' + target.cy.animVal.value;
			var puntoinserta = target.cx.animVal.value + ',' + target.cy.animVal.value + ' ' + (target.cx.animVal.value + 2) + ',' + (target.cy.animVal.value - 2);
			puntos = seleccionado.points;
			var ptos = puntos.numberOfItems;
			pruta = '';
			for (var incrementador = 0; incrementador < ptos; incrementador++) {
				pruta += puntos.getItem(incrementador).x + "," + puntos.getItem(incrementador).y + " ";
			}
			var pruta1 = pruta.replace(puntoanterior, puntoinserta);
			poli4d(seleccionado.id, pruta1, ' ');
			quitablips('__4Dblip');
			seleccione(seleccionado);
		}
	}
}
function rueda(e) {
    e = window.event || e;  var target = e.target;
    if (croping) {
        var delta = Math.max(-1, Math.min(1, e.wheelDelta || -e.detail));
        zoom = zoom + delta;
        muestrazoom();
    }
}
function clicdere(e) {
    e.preventDefault();
}
function clicmouse(e) {
	e = window.event || e;
	x = parseInt(e.pageX);
	y = parseInt(e.pageY);
	var target = e.target;
	if (croping) {cropiado();}
	if (gotero) {
		document.getElementById("_gota").remove();
		colorfill = document.getElementById('pat').style.fill;

		gotero = false;
		document.getElementById('panel4d').style.cursor = 'default';
		rehacerfila4d();
		document.getElementById('b3').className.baseVal = "boton";
	}
	if (moviendoblip) {
		c4d(x, y, 3, moviendoblip, 'lime', 'lime', 'panel4d');
		rehacerfila4d();
		moviendoblip = '';
	} else {
		if (dibujando === 1) {
			cli();
		} else {
			if (target.id.indexOf('__4Dblip') >= 0) {
				moviendoblip = target.id;
				puntoanterior = target.cx.animVal.value + ',' + target.cy.animVal.value;
			} else {
				if (target.id.indexOf('__4Drect') >= 0) {
					moviendotexto = target.id;
				} else {
					if (seleccionado) {
							limpiar4d();
					} else {
						seleccione(e.target);
					}
				}
				
			}
		}
	}
}
function colorpic4d() {
	if (gotero) {
		gotero = false;
		document.getElementById('panel4d').style.cursor = 'default';
	} else {
		gotero = true;
		document.getElementById('panel4d').style.cursor = 'none';
		document.getElementById('b3').className.baseVal = "bactivo";
	}
}
function chupacolor() {
	var rojo = canvas4d.getImageData(x, y, 1, 1).data[0];
	var verde = canvas4d.getImageData(x, y, 1, 1).data[1];
	var azul = canvas4d.getImageData(x, y, 1, 1).data[2];
	var alfa = canvas4d.getImageData(x, y, 1, 1).data[3];
	rojo = (rojo < 16 ? "0" : "") + rojo.toString(16).toUpperCase();
	verde = (verde < 16 ? "0" : "") + verde.toString(16).toUpperCase();
	azul = (azul < 16 ? "0" : "") + azul.toString(16).toUpperCase();
	alfa = (alfa < 16 ? "0" : "") + alfa.toString(16).toUpperCase();
	colorchupado = "#" + rojo + verde + azul + alfa;
	actualiza4d(colorchupado);
}
function poly4d() {
	if (dibujando == 1) {
		x = pix;y = piy; cli();
		dibujando = 0;
		cier4d();
		rehacerfila4d();
		document.getElementById('panel4d').style.cursor = 'default';
		document.getElementById('b2').className.baseVal = "boton";
	} else {
		document.getElementById('b2').className.baseVal = "bactivo";
		limpiar4d();
		dibujando = 1;
		curso();
		document.getElementById('panel4d').style.cursor = 'none';
	}
}
function curso() {
	var sty = '', cu = '';
	if (dibujando === 1) {
		if (pa !== '') {
			sty = 'fill: none; stroke: red; stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;';
			cu = pa + ',' + x + ',' + y;
			poli4d('_temp', cu, sty);
		}
		sty = 'fill: none; stroke: blue; stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;';
		cu = x - 2 + ',' + (y - 2) + ',' + (x + 2) + ',' + (y - 2) + ',' + (x + 2) + ',' + (y + 2) + ',' + (x - 2) + ',' + (y + 2) + ',' + (x - 2) + ',' + (y - 2);
		poli4d('_curs', cu, sty);
	}
}
function cier4d() {
    moviendotexto='', seleccionado = '', boton = '', dibujando = 0,	k = 0, pi = '',	pa = '';
	if (document.getElementById('_curs')) {
		document.getElementById('_curs').remove();
	}
	if (document.getElementById('_temp')) {
		document.getElementById('_temp').remove();
	}
	document.getElementById('panel4d').style.cursor = 'default';
}
function limpiar4d() {
	quitablips('__4Dblip');
	quitablips('__4Drect'); 
	seleccionado = '';
}
function rehacerfila4d() {
	fila4d = [];
	var j = 0;
	var nodos = document.getElementById("panel4d").childNodes.length;
	for (var incrementador = 0; incrementador < nodos; incrementador++) {
		var objeto = document.getElementById("panel4d").childNodes[incrementador];
		var pid = objeto.id;
		if (pid) {
			if (pid.indexOf('__4Dblip') < 0 && pid.indexOf('_espiral') < 0 && pid.indexOf('_coloralfa') < 0 && pid.indexOf('_colorrojo') < 0 && pid.indexOf('_colorverde') < 0 && pid.indexOf('_colorazul') < 0) {
				if (pid != '_curs' && pid != '_temp') {
					sty = "fill: " + objeto.style.fill + "; stroke: " + objeto.style.stroke + "; stroke-width: " + objeto.style.strokeWidth + "; stroke-linecap: round;stroke-linejoin: round;";
					puntos = objeto.points;
					if (puntos) {
					var ptos = puntos.numberOfItems;
					var pruta = '';
					for (var i = 0; i < ptos; i++) {
						pruta += puntos.getItem(i).x + "," + puntos.getItem(i).y + " ";
					}
					fila4d[j] = j + "|" + "checked|polyline|" + pid + "| | |" + pruta + "|" + sty;
					j++;
					}
				}
			}
		}
	}
}
function quitablips(texto) {
	var nodos = document.getElementById("panel4d").childNodes.length - 1;
	for (var incrementador = nodos; incrementador > 0; incrementador--) {
		var objeto = document.getElementById("panel4d").childNodes[incrementador];
		var pid = objeto.id;
		if (pid) {
			if (pid.indexOf(texto) >= 0) {
				document.getElementById("panel4d").removeChild(objeto);
			}
		}
	}
	blip = 0;
}
function poneblips(pid, puntos, fil) {
	var ptos = puntos.numberOfItems;
	var pruta = '';
	for (var incrementador = 0; incrementador < ptos; incrementador++) {
		blip++;
		c4d(puntos.getItem(incrementador).x, puntos.getItem(incrementador).y, 1, pid + blip, 'rgba(0,255,0,0.1)', fil, 'panel4d');
		pruta += puntos.getItem(incrementador).x + "," + puntos.getItem(incrementador).y + " ";
	}
}
function actualiza4d(pcolor){
	colorstroke=pcolor;
	colorfil="none";
	document.getElementById('ruta').style.stroke=colorstroke;
	document.getElementById('relleno').style.fill=colorstroke;
	document.getElementById('atras').style.fill=colorstroke;
	document.getElementById('pat').style.fill=colorstroke;	
	if (seleccionado) {
			puntos = seleccionado.points;
			var ptos = puntos.numberOfItems;
			var pruta = '';
			for (var incrementador = 0; incrementador < ptos; incrementador++) {
				pruta += puntos.getItem(incrementador).x + "," + puntos.getItem(incrementador).y + " ";
			}
			sty = 'fill: ' + pcolor + '; stroke: ' + pcolor + '; stroke-width: 1; stroke-linecap: round; stroke-linejoin: round;';
			poli4d(seleccionado.id, pruta, sty);
			rehacerfila4d();
		}
}
function c4d(cx, cy, radio, pid, fil, str, pan) {
	var o4d;
	if (document.getElementById(pid)) {
		o4d = document.getElementById(pid);
	} else {
		o4d = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
		var antialias = 'true';
		o4d.setAttribute('shape-rendering', antialias ? 'auto' : 'optimizeSpeed');
		o4d.setAttribute('id', pid);
	}
	if (cx)
		o4d.setAttribute('cx', cx);
	if (cy)
		o4d.setAttribute('cy', cy);
	if (radio)
		o4d.setAttribute('r', radio);
	o4d.setAttribute('fill', fil);
	o4d.setAttribute('stroke', str);
	o4d.addEventListener('mouseover', sobremi, false);
	o4d.addEventListener('mouseout', fuerami, false);
	if (!document.getElementById(pid)) {
		document.getElementById(pan).appendChild(o4d);
	}
}
function sobremi(evt) {
	var target = evt.target;
	target.setAttributeNS(null, 'style', 'cursor:pointer;cursor:hand;');
	target.setAttributeNS(null, 'fill', 'red');
	target.setAttributeNS(null, 'stroke', 'red');
}
function fuerami(evt) {
	var target = evt.target;
	target.setAttributeNS(null, 'fill', 'rgba(0,255,0,0.1)');
	target.setAttributeNS(null, 'stroke', 'lime');
}
function propiedades4d(objeto) {
	colorfil=objeto.style.fill;
	colorstroke=objeto.style.stroke;
	document.getElementById('ruta').style.stroke=colorstroke;
	document.getElementById('relleno').style.fill=colorfil;
	document.getElementById('atras').style.fill=colorstroke;
}
function suiche4d(pid) {if (document.getElementById(pid).style.display == "block" || document.getElementById(pid).style.display == "undefined") {document.getElementById(pid).style.display = "none";} else {document.getElementById(pid).style.display = "block";}}
function poli4d(pid, pts, sty) {if (pts.indexOf("undefined")<0 && pts.indexOf("NaN")<0){var o4d; if (document.getElementById(pid)) {o4d = document.getElementById(pid);} else {o4d = document.createElementNS("http://www.w3.org/2000/svg", "polyline"); o4d.setAttribute("id", pid); o4d.setAttribute("shape-rendering", "geometricPrecision"); } o4d.setAttribute("points", pts);                                                                                       if (sty !== " ") {o4d.setAttribute("style", sty);}                       if (!document.getElementById(pid)) {document.getElementById("panel4d").appendChild(o4d);}}}
function componentToHex(c) {var hex = c.toString(16);return hex.length == 1 ? "0" + hex : hex;}
function rgbToHex(r, g, b) {return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);}
function p4d(x1, y1, x2, y2, x3, y4, x4, y4) {var divisor = ((y4 - y3) * (x2 - x1) - (x4 - x3) * (y2 - y1)); if (divisor === 0) { return { x5: NaN, y5: NaN }; } var x5 = x1 + ((x4 - x3) * (y1 - y3) - (y4 - y3) * (x1 - x3)) / divisor * (x2 - x1); var y5 = y1 + ((x4 - x3) * (y1 - y3) - (y4 - y3) * (x1 - x3)) / divisor * (y2 - y1); return { x5: x5, y5: y5 }; }
function ruta4d(name, pathData, fillColor, strokeColor, strokeWidth) { if (pathData.indexOf("undefined") < 0 && pathData.indexOf("NaN") < 0) { var o4d; if (document.getElementById(name)) { o4d = document.getElementById(name); } else { o4d = document.createElementNS("http://www.w3.org/2000/svg", "path"); o4d.setAttribute("id", name);	o4d.setAttribute("stroke-linecap", "round");} o4d.setAttribute("d", pathData); if (fillColor !== " ") { o4d.setAttribute("fill", fillColor); } if (strokeWidth !== " ") { o4d.setAttribute("stroke-width", strokeWidth); }if (strokeColor !== " ") { o4d.setAttribute("stroke", strokeColor); } if (!document.getElementById(name)) { document.getElementById("panel4d").appendChild(o4d);  }}}
function circ4d(pid, pcx, pcy, pra, sty){if (!isNaN(pcx) && !isNaN(pcy)){var o4d; if (document.getElementById(pid)) {o4d = document.getElementById(pid);} else {o4d = document.createElementNS('http://www.w3.org/2000/svg', 'circle');  o4d.setAttribute('shape-rendering', 'geometricPrecision'); o4d.setAttribute('id', pid);} o4d.setAttribute('cx', pcx);o4d.setAttribute('cy', pcy); o4d.setAttribute('r', pra);	                            if (sty !== ' ') {o4d.setAttribute('style', sty);}if (!document.getElementById(pid)) {document.getElementById('panel4d').appendChild(o4d);}}}
function poli4dm(panel, pid, pts, sty) {if (pts.indexOf("undefined")<0 && pts.indexOf("NaN")<0){var o4d;if (document.getElementById(pid)) {o4d = document.getElementById(pid);} else {o4d = document.createElementNS("http://www.w3.org/2000/svg", "polyline");o4d.setAttribute("id", pid);o4d.setAttribute("shape-rendering", "geometricPrecision"); }o4d.setAttribute("points", pts);                                                                                               if (sty !== " ") {o4d.setAttribute("style", sty);}if (!document.getElementById(pid)) {document.getElementById(panel).appendChild(o4d);}    }}
function circ4dm(panel, pid, pcx, pcy, pra, sty){if (!isNaN(pcx) && !isNaN(pcy)){var o4d; if (document.getElementById(pid)) {o4d = document.getElementById(pid);} else {o4d = document.createElementNS('http://www.w3.org/2000/svg', 'circle');  o4d.setAttribute('shape-rendering', 'geometricPrecision'); o4d.setAttribute('id', pid);} o4d.setAttribute('cx', pcx);o4d.setAttribute('cy', pcy); o4d.setAttribute('r', pra);	                            if (sty !== ' ') {o4d.setAttribute('style', sty);}if (!document.getElementById(pid)) {document.getElementById(panel).appendChild(o4d);}}}
function elip4dm(panel, pid, pcx, pcy, prx, pry, sty) {var o4d; if (document.getElementById(pid)) {o4d = document.getElementById(pid);} else {o4d = document.createElementNS('http://www.w3.org/2000/svg', 'ellipse'); o4d.setAttribute('shape-rendering', 'geometricPrecision'); o4d.setAttribute('id', pid);} o4d.setAttribute('cx', pcx);o4d.setAttribute('cy', pcy); o4d.setAttribute('rx', prx); o4d.setAttribute('ry', pry);	if (sty !== ' ') {o4d.setAttribute('style', sty);}if (!document.getElementById(pid)) {document.getElementById(panel).appendChild(o4d);}}
function text4dm(panel, pid, px, py, sty, txt) {var o4d; if (document.getElementById(pid)) {o4d = document.getElementById(pid);} else {o4d = document.createElementNS("http://www.w3.org/2000/svg", "text");    o4d.setAttribute("shape-rendering", "geometricPrecision"); o4d.setAttribute("id", pid);} o4d.setAttribute("x", px);   o4d.setAttribute("y", py);if (sty !== " ") {o4d.setAttribute("style", sty);} o4d.textContent = txt;if (!document.getElementById(pid)) {document.getElementById(panel).appendChild(o4d);}}
function text4da(pid, px, py, sty, txt, ali) { var o4d; if (document.getElementById(pid)) { o4d = document.getElementById(pid); } else { o4d = document.createElementNS("http://www.w3.org/2000/svg", "text"); o4d.setAttribute("shape-rendering", "geometricPrecision"); o4d.setAttribute("id", pid); } o4d.setAttribute("x", px); o4d.setAttribute("y", py); if (sty !== " ") { o4d.setAttribute("style", sty); } o4d.textContent = txt; if (ali !== "") {if (ali==0){o4d.setAttribute("alignment-baseline", "start");o4d.setAttribute("text-anchor", "start");}if (ali==1){o4d.setAttribute("alignment-baseline", "middle");o4d.setAttribute("text-anchor", "middle");}if (ali==2){o4d.setAttribute("alignment-baseline", "end");o4d.setAttribute("text-anchor", "end"); 	}}if (!document.getElementById(pid)) { document.getElementById("panel4d").appendChild(o4d); } }
function numeroconcomas(x) {var parts = x.toString().split(".");parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");return parts.join(".");}
</script>
</body>
</html>
